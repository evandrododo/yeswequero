<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>VOTE 43 - Eduardo Jorge</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="css/normalize.min.css">
        <link rel="stylesheet" href="css/main.css">

        <link rel="icon" href="favicon-16.png" sizes="16x16"/>
        <link rel="icon" href="favicon-32.png" sizes="32x32"/>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
		<script>
		$(document).ready(function(){
			
		});
		</script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <div class="header-container">
            <header class="wrapper clearfix">
                <h1 class="title">YES WE <span class="title-claro"> QUERO</span></h1>
            </header>
        </div>

        <div class="main-container">
            <div class="main wrapper clearfix">

                <article>
          <p><h3>Apoie Eduardo Jorge no facebook!</h3></p>
          <p>Insira aqui a sua <strong>#hashtag</strong> e mude sua foto de perfil:</p>	
          <p><input type="text" name="hashtag" id="hashtag" placeholder="YESWEQUERO">		</p>
					 <button id="getbtn" class="btn" onclick="getProfilePicture()">Personalize sua foto</button> 
					 <button id="setbtn" class="btn" onclick="setProfilePicture()" style="display: none;">Salvar no Facebook</button> <br>
					 <div class="photo"></div>
					 <div id="fb-root"></div>
            <script>
					  var pid;
					  var imgURL;
					  window.fbAsyncInit = function() {
						FB.init({
						  appId      : '342337162600646',
						  xfbml      : true,
						  version    : 'v2.1'
						});
					  };

					  (function(d, s, id){
						 var js, fjs = d.getElementsByTagName(s)[0];
						 if (d.getElementById(id)) {return;}
						 js = d.createElement(s); js.id = id;
						 js.src = "//connect.facebook.net/en_US/sdk.js";
						 fjs.parentNode.insertBefore(js, fjs);
					   }(document, 'script', 'facebook-jssdk'));
					   
					   function getProfilePicture() {					
						   FB.login(function(response) {
							   if (response.authResponse) {
								 console.log('Welcome!  Fetching your information.... ');

								 FB.api('/me', function(response) {
								   console.log('Good to see you, ' + response.name + '.' );
								   pid = response.id;
								   console.log(pid);
								 });
								 FB.api(
									"/me/picture",
									{
										"redirect": false,
										"height": "9999",
										"type": "normal",
										"width": "9999"
									},
									function (response) {
										if (response.data){
											console.log(response.data.url);
											$.get( "http://evandrocarreira.com.br/site/yeswequero/",
												{ img: response.data.url } ,
												function( data ) {
													
												});
											imgURL = 'http://evandrocarreira.com.br/site/yeswequero/?hash='+encodeURIComponent($("#hashtag").val())+'&img='+encodeURIComponent(response.data.url);
                            $('.main-container').addClass("sembg");
                            $('.photo').append('<img  src=\"' + imgURL + '\">');
														$('#getbtn').css("display", "none");
														$('#setbtn').css("display", "block");
										}
										
									});
							   } else {
								 console.log('User cancelled login or did not fully authorize.');
							   }
							 },
              {
              scope: 'publish_actions',
              return_scopes : true
              });
						}
						function setProfilePicture(){
							savePhoto()	;
						}
						
						function savePhoto(){
							FB.login(
							  function(response) 
                {
  								console.log(response.authResponse.grantedScopes);
                  if(response.authResponse.grantedScopes == "public_profile,publish_actions" ){
  									FB.api(
  										"/me/photos",
  										"POST",
  										{
  											"url": imgURL,
  											message: $("#hashtag").val()
  										},
  										function (response) {
  											if(response.id){
  												console.log(response.id);
  												//alert('Foi');
  												window.location = 'https://www.facebook.com/photo.php?fbid=' + response.id + '&makeprofile=1';
  											}
  											else{
  												//alert('Não foi');
  											}
  										}
  									);
  								}
  								else{
  									alert('Putz! \nSe você está vendo esse aviso, infelizmente o facebook ainda não autorizou o upload de fotos do App :(\n\nPara poder usar essa foto lindona aí atrás de perfil, vc precisa salvar ela e adicionar pelo facebook (Mas é rapidinho :P)');
  								}
						    },
  						  {
    							scope: 'publish_actions',
    							return_scopes : true,
                  auth_type: 'rerequest'
  						  }
							);						
						}
					</script>
                </article>

            </div> <!-- #main -->
        </div> <!-- #main-container -->

        <div class="footer-container">
            <footer class="wrapper">
                <span class="right">Desenvolvido por <a href="http://evandrocarreira.com.br">Evandro Carreira</a> e <a href="https://www.facebook.com/profile.php?id=100008057801235">Rafael Miranda</a>
                </span>
                <span class="left">&nbsp;Não temos qualquer ligação com o Candidato ou com o partido.
                :)&nbsp;
                </span>
                <span class="left">
                <a href="//www.iubenda.com/privacy-policy/763697" class="iubenda-white iubenda-embed" title="Privacy Policy">Privacy Policy</a><script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src = "//cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>
                </span>
            </footer>
        </div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.1.min.js"><\/script>')</script>

        <script src="js/main.js"></script>

    </body>
</html>
